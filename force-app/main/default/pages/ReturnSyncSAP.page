<apex:page controller="returnToSAPController" title="回款同步(货款)"  docType="html-5.0"> 
   <c:importvisualstrap theme="default" /> 
   <apex:form >
       <apex:selectList id="chooseColor" value="{!PickListVal}" size="1"> 
          <apex:selectOption itemValue="All" itemLabel="All"/>
          <apex:selectOption itemValue="CC01" itemLabel="CC01"/> 
          <apex:selectOption itemValue="CC02" itemLabel="CC02"/> 
          <apex:selectOption itemValue="CC03" itemLabel="CC03"/> 
          <apex:selectOption itemValue="CC08" itemLabel="CC08"/>
          <apex:selectOption itemValue="CC09" itemLabel="CC09"/>
          <apex:selectOption itemValue="CC14" itemLabel="CC14"/>
          <apex:selectOption itemValue="CC23" itemLabel="CC23"/>
          <apex:selectOption itemValue="U003" itemLabel="U003"/>
          <apex:selectOption itemValue="CC11" itemLabel="CC11"/>
       </apex:selectList>
       <apex:commandButton value="提交" action="{!Refresh}"/>
     </apex:form>
   <c:visualstrapblock id="strap"> 
       <center>
         <c:pageheader title="Salesforce Sync SAP Tool" icon="calendar" subtitle="回款(货款) {!$User.FirstName} {!$User.LastName}" style="margin:5px 0 20px"/>
       </center> 
   </c:visualstrapblock> 
   <!--引用Salesforce的JS-->
  <script type="text/javascript">
    var __sfdcSessionId = '{!GETSESSIONID()}';
  </script>
  <script src="/soap/ajax/37.0/connection.js" type="text/javascript"></script>
   <script>
     function selectAll(){
        var tempVar = document.getElementsByClassName("ChioceALL");
        for(var i = 0;i < tempVar.length; i++){
           document.getElementsByClassName("ChioceALL")[i].checked = true;
        }
        return false;
     }
     
     function getChildRecord(RecordId){
       var DrawStr1 = "";
       var records1 = sforce.connection.query("Select Id, Name, contractName__c, returnNumber__c, amount__c, returnUserName__c, center__c, department__c, province__c, incomeType__c, LastModifiedDate from returnItem__c where returnPool__c ='" + RecordId + "'").getArray('records');
       for (var i=0; i< records1.length; i++) { 
           DrawStr1 = DrawStr1 +  "<tr><td>"+ Number(i+1) +"</td><td>" 
             + records1[i].Name + "</td><td>"
             + records1[i].contractName__c+ "</td><td>"
             + records1[i].returnNumber__c + "</td><td>"
             + records1[i].amount__c + "</td><td>"
             + records1[i].returnUserName__c + "</td><td>"
             + records1[i].center__c + "</td><td>"
             + records1[i].department__c + "</td><td>"
             + records1[i].province__c + "</td><td>"
             + records1[i].incomeType__c + "</td><td>"
             + records1[i].LastModifiedDate + "</td></tr>";
       }
       var tempVar1 = document.getElementsByClassName("tbodySAP1")[0];
       
       tempVar1.innerHTML = DrawStr1;
       $('#newCase').modal('show');
     
     }

   </script>
   
   <apex:includeScript value="{!URLFOR($Resource.jquery,'jquery.min.js')}"/>
   <apex:includeScript value="{!URLFOR($Resource.bootstrap,'bootstrap.min.js')}"/>

  <apex:form >
    
       <c:visualstrapblock > 
  
       <c:modal id="newCase" title="回款拆分项">
         <apex:outputPanel layout="block" id="newCasePanel" title="回款拆分项">
           <table class="table" style="width:100%">
             <thead>
               <tr>
               <th>#</th>
               <th>编号</th>
               <th>合同号</th>
               <th>回款编号</th>
               <th>回款金额</th>
               <th>回款责任人</th>
               <th>中心</th>
               <th>部门</th>
               <th>省区</th>
               <th>应/预收</th>
               <th>最后修改时间</th>
               </tr>
             </thead>
            <tbody class="tbodySAP1" styleClass ="tbodySAP1" ></tbody>
          </table>       
        
          <apex:outputPanel layout="block" styleClass="modal-footer">

          </apex:outputPanel>
        
          <apex:outputPanel >
              <script>$('#newCase').modal('hide');</script>
          </apex:outputPanel>
        </apex:outputPanel>
      </c:modal>  
    
    </c:visualstrapblock>
    
    
    
    <apex:pageBlock id="pgTable">
        <apex:commandButton value="全选" action="{!SaveS}" onclick="return selectAll();"/>      
      <apex:pageBlockButtons location="top">
        <apex:commandButton value="同步给SAP" action="{!SaveS}" status="SAPSts"/>
        <apex:commandButton value="刷新" action="{!Refresh}"/>
        <apex:actionStatus id="SAPSts" startText="同步进行中,请等待..."/>
      </apex:pageBlockButtons>
      <apex:outputlabel >&nbsp;&nbsp;&nbsp;系统只显示确认清分完成并且未同步到SAP的回款记录</apex:outputlabel><br/>
      <apex:pageBlockTable value="{!RTSList}" var="c" id="pgBlock">
        <apex:column headerValue="选择">
          <apex:inputcheckbox value="{!c.flag}" styleClass="ChioceALL"></apex:inputcheckbox>
        </apex:column> 
        <apex:column headerValue="操作" >
           <a class="btn btn-info btn-md" onclick="getChildRecord('{!c.ReturnId}');">查看详细</a>
        </apex:column>
        <apex:column headerValue="回款编号" >
           <apex:outputLink value="/{!c.ReturnId}">{!c.ReturnName}</apex:outputLink>          
        </apex:column>  
        <apex:column headerValue="客户名称">
           <apex:outputLink value="/{!c.AccountId}">{!c.AccountName}</apex:outputLink>          
        </apex:column>
        <apex:column headerValue="金额">
           <apex:outputLabel >{!c.Amount}</apex:outputLabel>          
        </apex:column>  
        <apex:column headerValue="到款日期">
           <apex:outputLabel >{!c.ArrivedDate}</apex:outputLabel>          
        </apex:column> 
        <apex:column headerValue="确认时间">
           <apex:outputLabel >{!c.ConfirmDate}</apex:outputLabel>          
        </apex:column> 
        <apex:column headerValue="所属公司">
           <apex:outputLabel >{!c.OrgCode}</apex:outputLabel>          
        </apex:column> 
        <apex:column headerValue="过账日期">
           <apex:input type="date" value="{!c.DateA}"></apex:input>          
        </apex:column>             
      </apex:pageBlockTable>
      <apex:pageBlockSection >
        <apex:commandButton value="上一页" action="{!Previous}" rerender="pgTable,pgBlock" status="status" disabled="{!PreviousStatus}" style="float:left"/>
        <apex:commandButton value="下一页" action="{!Next}" reRender="pgTable,pgBlock" status="status" disabled="{!NextStatus}" style="float:right"/>
        <apex:actionStatus id="status" startText="Please Wait..."/>
      </apex:pageBlockSection>
    </apex:pageBlock>
  </apex:form>
   
</apex:page>